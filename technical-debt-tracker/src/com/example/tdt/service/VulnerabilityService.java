package com.example.tdt.service;

import com.example.tdt.model.Dependency;
import com.example.tdt.model.Project;
import com.example.tdt.model.VulnerabilityReport;

import java.util.HashMap;
import java.util.Map;

public class VulnerabilityService {

    private static final Map<String, String> VULNERABLE_DEPENDENCIES = new HashMap<>();
    static {
        VULNERABLE_DEPENDENCIES.put("org.apache.logging.log4j:log4j-core", "2.17.2");
        VULNERABLE_DEPENDENCIES.put("commons-io:commons-io", "2.11.0");
    }

    public VulnerabilityReport checkVulnerabilities(Project project) {
        VulnerabilityReport report = new VulnerabilityReport(project.getId());
        for (Dependency d : project.getDependencies()) {
            String key = d.getGroupId() + ":" + d.getArtifactId();
            if (VULNERABLE_DEPENDENCIES.containsKey(key)) {
                report.addVulnerableDependency(d, VULNERABLE_DEPENDENCIES.get(key));
            }
        }
        return report;
    }

    public Project recommendDependencyUpdates(Project project) {
        Project copy = new Project(project.getName(), project.getDescription());
        copy.setId(project.getId());
        for (Dependency d : project.getDependencies()) {
            String key = d.getGroupId() + ":" + d.getArtifactId();
            if (VULNERABLE_DEPENDENCIES.containsKey(key)) {
                copy.addDependency(new Dependency(d.getGroupId(), d.getArtifactId(), VULNERABLE_DEPENDENCIES.get(key)));
            } else {
                copy.addDependency(d);
            }
        }
        return copy;
    }
}
